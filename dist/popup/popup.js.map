{
  "version": 3,
  "sources": ["../../src/popup/popup.ts"],
  "sourcesContent": ["/**\n * Popup Settings Panel for Udemy \u5B57\u5E55\u589E\u5F3A\n * Task ID: T-20251223-act-009-build-popup-settings\n *\n * Handles:\n * - Provider selection (OpenAI / Gemini)\n * - API Key input and validation\n * - Model selection\n * - Main toggle for subtitle replacement\n * - Settings persistence via chrome.storage.sync\n */\n\nimport type { UserSettings } from '../types';\n\n// ============================================\n// Constants\n// ============================================\n\n/**\n * Available models for each provider\n */\nconst PROVIDER_MODELS: Record<string, { value: string; label: string }[]> = {\n  openai: [\n    { value: 'gpt-5.2', label: 'GPT-5.2' },\n    { value: 'gpt-5.1', label: 'GPT-5.1 (\u63A8\u8350)' },\n    { value: 'gpt-5-pro', label: 'GPT-5 Pro' },\n    { value: 'gpt-5', label: 'GPT-5' },\n  ],\n  gemini: [\n    { value: 'gemini-3-pro-preview', label: 'Gemini 3 Pro Preview' },\n    { value: 'gemini-3-flash-preview', label: 'Gemini 3 Flash Preview (\u63A8\u8350)' },\n    { value: 'gemini-2.5-pro', label: 'Gemini 2.5 Pro' },\n    { value: 'gemini-2.5-flash', label: 'Gemini 2.5 Flash' },\n  ],\n};\n\n/**\n * Default settings\n */\nconst DEFAULT_SETTINGS: UserSettings = {\n  provider: 'openai',\n  apiKey: '',\n  model: 'gpt-5.1',\n  enabled: true,\n  autoTranslate: true,\n  preloadEnabled: true,\n  showCostEstimate: true,\n  showLoadingIndicator: true,\n};\n\n/**\n * API endpoints for validation\n */\nconst API_ENDPOINTS = {\n  openai: 'https://api.openai.com/v1/models',\n  gemini: 'https://generativelanguage.googleapis.com/v1beta/models',\n};\n\n// ============================================\n// Session Cost (chrome.storage.session)\n// ============================================\n\ninterface SessionCostState {\n  totals: {\n    totalTokens: number;\n    totalCostUsd: number;\n    updatedAt: number;\n  };\n  lastEstimate?: {\n    taskId: string;\n    provider: 'openai' | 'gemini';\n    model: string;\n    cueCount: number;\n    estimatedTotalTokens: number;\n    estimatedCostUsd: number;\n    createdAt: number;\n  };\n  lastActual?: {\n    taskId: string;\n    provider: 'openai' | 'gemini';\n    model: string;\n    tokensUsed: number;\n    costUsd: number;\n    createdAt: number;\n  };\n}\n\nconst SESSION_COST_KEY = 'udemy-caption-plus:session-cost';\n\nconst DEFAULT_SESSION_COST_STATE: SessionCostState = {\n  totals: {\n    totalTokens: 0,\n    totalCostUsd: 0,\n    updatedAt: 0,\n  },\n};\n\n// ============================================\n// DOM Elements\n// ============================================\n\ninterface DOMElements {\n  // Main toggle\n  enabled: HTMLInputElement;\n  // Form elements\n  settingsForm: HTMLFormElement;\n  provider: HTMLSelectElement;\n  apiKey: HTMLInputElement;\n  model: HTMLSelectElement;\n  toggleApiKeyVisibility: HTMLButtonElement;\n  // Buttons\n  saveBtn: HTMLButtonElement;\n  retranslateBtn: HTMLButtonElement;\n  // Status\n  statusMessage: HTMLDivElement;\n  validationResult: HTMLDivElement;\n  // Cost display\n  costDisplay: HTMLDivElement;\n  costEstimate: HTMLSpanElement;\n  costActual: HTMLSpanElement;\n  costSession: HTMLSpanElement;\n  // Additional settings\n  autoTranslate: HTMLInputElement;\n  preloadEnabled: HTMLInputElement;\n  showCostEstimate: HTMLInputElement;\n  showLoadingIndicator: HTMLInputElement;\n}\n\nlet elements: DOMElements;\nlet statusAutoHideTimer: number | null = null;\nlet currentRetranslateTaskId: string | null = null;\nlet sessionCostState: SessionCostState = structuredClone(DEFAULT_SESSION_COST_STATE);\n\n// ============================================\n// Storage Functions\n// ============================================\n\n/**\n * Load settings from chrome.storage.sync\n */\nasync function loadSettings(): Promise<UserSettings> {\n  return new Promise((resolve) => {\n    if (typeof chrome !== 'undefined' && chrome.storage?.sync) {\n      chrome.storage.sync.get(DEFAULT_SETTINGS, (result) => {\n        resolve(result as UserSettings);\n      });\n    } else {\n      // Fallback for development/testing\n      const stored = localStorage.getItem('udemy-caption-settings');\n      if (stored) {\n        try {\n          resolve({ ...DEFAULT_SETTINGS, ...JSON.parse(stored) });\n        } catch {\n          resolve(DEFAULT_SETTINGS);\n        }\n      } else {\n        resolve(DEFAULT_SETTINGS);\n      }\n    }\n  });\n}\n\n/**\n * Save settings to chrome.storage.sync\n */\nasync function saveSettings(settings: Partial<UserSettings>): Promise<void> {\n  return new Promise((resolve, reject) => {\n    if (typeof chrome !== 'undefined' && chrome.storage?.sync) {\n      chrome.storage.sync.set(settings, () => {\n        if (chrome.runtime.lastError) {\n          reject(new Error(chrome.runtime.lastError.message));\n        } else {\n          resolve();\n        }\n      });\n    } else {\n      // Fallback for development/testing\n      const current = localStorage.getItem('udemy-caption-settings');\n      const merged = { ...(current ? JSON.parse(current) : DEFAULT_SETTINGS), ...settings };\n      localStorage.setItem('udemy-caption-settings', JSON.stringify(merged));\n      resolve();\n    }\n  });\n}\n\n// ============================================\n// Session Cost Functions\n// ============================================\n\nfunction hasSessionStorage(): boolean {\n  return typeof chrome !== 'undefined' && !!chrome.storage?.session;\n}\n\nasync function loadSessionCost(): Promise<SessionCostState> {\n  if (hasSessionStorage()) {\n    return new Promise((resolve) => {\n      chrome.storage.session.get({ [SESSION_COST_KEY]: DEFAULT_SESSION_COST_STATE }, (result) => {\n        const value = (result as Record<string, SessionCostState>)[SESSION_COST_KEY];\n        resolve(value ?? structuredClone(DEFAULT_SESSION_COST_STATE));\n      });\n    });\n  }\n\n  // Development/testing fallback\n  const stored = localStorage.getItem(SESSION_COST_KEY);\n  if (!stored) return structuredClone(DEFAULT_SESSION_COST_STATE);\n  try {\n    return { ...structuredClone(DEFAULT_SESSION_COST_STATE), ...JSON.parse(stored) } as SessionCostState;\n  } catch {\n    return structuredClone(DEFAULT_SESSION_COST_STATE);\n  }\n}\n\n/**\n * Notify content scripts of settings change\n */\nasync function notifySettingsChanged(settings: UserSettings): Promise<void> {\n  if (typeof chrome !== 'undefined' && chrome.tabs) {\n    try {\n      const tabs = await chrome.tabs.query({ url: '*://*.udemy.com/*' });\n      for (const tab of tabs) {\n        if (tab.id) {\n          chrome.tabs.sendMessage(tab.id, {\n            type: 'SETTINGS_UPDATED',\n            payload: settings,\n          }).catch(() => {\n            // Tab might not have content script loaded\n          });\n        }\n      }\n    } catch {\n      // Ignore errors\n    }\n  }\n}\n\n// ============================================\n// API Validation Functions\n// ============================================\n\n/**\n * Validate OpenAI API key\n */\nasync function validateOpenAIKey(apiKey: string): Promise<{ valid: boolean; error?: string }> {\n  try {\n    const response = await fetch(API_ENDPOINTS.openai, {\n      method: 'GET',\n      headers: {\n        Authorization: `Bearer ${apiKey}`,\n      },\n    });\n\n    if (response.ok) {\n      return { valid: true };\n    }\n\n    if (response.status === 401) {\n      return { valid: false, error: 'API Key \u65E0\u6548\u6216\u5DF2\u8FC7\u671F' };\n    }\n\n    if (response.status === 429) {\n      return { valid: false, error: '\u8BF7\u6C42\u8FC7\u4E8E\u9891\u7E41\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5' };\n    }\n\n    const data = await response.json().catch(() => ({}));\n    return {\n      valid: false,\n      error: data.error?.message || `\u9A8C\u8BC1\u5931\u8D25 (${response.status})`,\n    };\n  } catch (error) {\n    return {\n      valid: false,\n      error: error instanceof Error ? error.message : '\u7F51\u7EDC\u9519\u8BEF\uFF0C\u8BF7\u68C0\u67E5\u7F51\u7EDC\u8FDE\u63A5',\n    };\n  }\n}\n\n/**\n * Validate Gemini API key\n */\nasync function validateGeminiKey(apiKey: string): Promise<{ valid: boolean; error?: string }> {\n  try {\n    const response = await fetch(`${API_ENDPOINTS.gemini}?key=${apiKey}`, {\n      method: 'GET',\n    });\n\n    if (response.ok) {\n      return { valid: true };\n    }\n\n    if (response.status === 400 || response.status === 403) {\n      return { valid: false, error: 'API Key \u65E0\u6548' };\n    }\n\n    if (response.status === 429) {\n      return { valid: false, error: '\u8BF7\u6C42\u8FC7\u4E8E\u9891\u7E41\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5' };\n    }\n\n    const data = await response.json().catch(() => ({}));\n    return {\n      valid: false,\n      error: data.error?.message || `\u9A8C\u8BC1\u5931\u8D25 (${response.status})`,\n    };\n  } catch (error) {\n    return {\n      valid: false,\n      error: error instanceof Error ? error.message : '\u7F51\u7EDC\u9519\u8BEF\uFF0C\u8BF7\u68C0\u67E5\u7F51\u7EDC\u8FDE\u63A5',\n    };\n  }\n}\n\n/**\n * Validate API key based on provider\n */\nasync function validateApiKey(\n  provider: 'openai' | 'gemini',\n  apiKey: string\n): Promise<{ valid: boolean; error?: string }> {\n  if (!apiKey.trim()) {\n    return { valid: false, error: '\u8BF7\u8F93\u5165 API Key' };\n  }\n\n  if (provider === 'openai') {\n    // Basic format check for OpenAI keys\n    if (!apiKey.startsWith('sk-')) {\n      return { valid: false, error: 'OpenAI API Key \u5E94\u4EE5 \"sk-\" \u5F00\u5934' };\n    }\n    return validateOpenAIKey(apiKey);\n  }\n\n  return validateGeminiKey(apiKey);\n}\n\n// ============================================\n// UI Functions\n// ============================================\n\n/**\n * Get DOM elements\n */\nfunction getDOMElements(): DOMElements {\n  return {\n    enabled: document.getElementById('enabled') as HTMLInputElement,\n    settingsForm: document.getElementById('settings-form') as HTMLFormElement,\n    provider: document.getElementById('provider') as HTMLSelectElement,\n    apiKey: document.getElementById('apiKey') as HTMLInputElement,\n    model: document.getElementById('model') as HTMLSelectElement,\n    toggleApiKeyVisibility: document.getElementById('toggle-apikey-visibility') as HTMLButtonElement,\n    saveBtn: document.getElementById('save-btn') as HTMLButtonElement,\n    retranslateBtn: document.getElementById('retranslate-btn') as HTMLButtonElement,\n    statusMessage: document.getElementById('status-message') as HTMLDivElement,\n    validationResult: document.getElementById('validation-result') as HTMLDivElement,\n    costDisplay: document.getElementById('cost-display') as HTMLDivElement,\n    costEstimate: document.getElementById('cost-estimate') as HTMLSpanElement,\n    costActual: document.getElementById('cost-actual') as HTMLSpanElement,\n    costSession: document.getElementById('cost-session') as HTMLSpanElement,\n    autoTranslate: document.getElementById('autoTranslate') as HTMLInputElement,\n    preloadEnabled: document.getElementById('preloadEnabled') as HTMLInputElement,\n    showCostEstimate: document.getElementById('showCostEstimate') as HTMLInputElement,\n    showLoadingIndicator: document.getElementById('showLoadingIndicator') as HTMLInputElement,\n  };\n}\n\n/**\n * Update model select options based on provider\n */\nfunction updateModelOptions(provider: string): void {\n  const models = PROVIDER_MODELS[provider] || [];\n  elements.model.innerHTML = models\n    .map((m) => `<option value=\"${m.value}\">${m.label}</option>`)\n    .join('');\n}\n\n/**\n * Show status message\n */\nfunction showStatus(message: string, type: 'success' | 'error' | 'info', autoHide = true): void {\n  if (statusAutoHideTimer) {\n    clearTimeout(statusAutoHideTimer);\n    statusAutoHideTimer = null;\n  }\n\n  elements.statusMessage.textContent = message;\n  elements.statusMessage.className = `status-message ${type}`;\n  elements.statusMessage.classList.remove('hidden');\n\n  if (autoHide) {\n    // Auto-hide after 3 seconds\n    statusAutoHideTimer = window.setTimeout(() => {\n      elements.statusMessage.classList.add('hidden');\n      statusAutoHideTimer = null;\n    }, 3000);\n  }\n}\n\nfunction setCostDisplayVisible(visible: boolean): void {\n  if (visible) {\n    elements.costDisplay.classList.remove('hidden');\n  } else {\n    elements.costDisplay.classList.add('hidden');\n  }\n}\n\nfunction formatTokenCount(tokenCount: number): string {\n  if (!Number.isFinite(tokenCount) || tokenCount <= 0) return '0';\n  if (tokenCount >= 1_000_000) return `${(tokenCount / 1_000_000).toFixed(2)}M`;\n  if (tokenCount >= 10_000) return `${(tokenCount / 1_000).toFixed(1)}K`;\n  return tokenCount.toLocaleString();\n}\n\nfunction formatUsd(costUsd: number): string {\n  if (!Number.isFinite(costUsd) || costUsd <= 0) return '$0';\n  const abs = Math.abs(costUsd);\n  if (abs >= 10) return `$${costUsd.toFixed(2)}`;\n  if (abs >= 1) return `$${costUsd.toFixed(3)}`;\n  if (abs >= 0.1) return `$${costUsd.toFixed(4)}`;\n  return `$${costUsd.toFixed(6)}`;\n}\n\nfunction formatTokensAndCost(tokenCount: number, costUsd: number, approx: boolean): string {\n  const tokens = `${formatTokenCount(tokenCount)} tokens`;\n  const cost = formatUsd(costUsd);\n  return `${approx ? '\u2248 ' : ''}${tokens} \u00B7 ${approx ? '\u2248 ' : ''}${cost}`;\n}\n\nfunction renderCostDisplay(): void {\n  const estimate = sessionCostState.lastEstimate;\n  const actual = sessionCostState.lastActual;\n\n  if (estimate) {\n    elements.costEstimate.textContent = formatTokensAndCost(\n      estimate.estimatedTotalTokens,\n      estimate.estimatedCostUsd,\n      true\n    );\n  } else {\n    elements.costEstimate.textContent = '-';\n  }\n\n  if (actual) {\n    elements.costActual.textContent = formatTokensAndCost(actual.tokensUsed, actual.costUsd, false);\n  } else {\n    elements.costActual.textContent = '-';\n  }\n\n  elements.costSession.textContent = formatTokensAndCost(\n    sessionCostState.totals.totalTokens,\n    sessionCostState.totals.totalCostUsd,\n    false\n  );\n}\n\n/**\n * Show validation result\n */\nfunction showValidationResult(valid: boolean, message: string): void {\n  elements.validationResult.className = `validation-result ${valid ? 'success' : 'error'}`;\n  elements.validationResult.querySelector('.validation-text')!.textContent = message;\n  elements.validationResult.classList.remove('hidden');\n}\n\n/**\n * Hide validation result\n */\nfunction hideValidationResult(): void {\n  elements.validationResult.classList.add('hidden');\n}\n\n/**\n * Set button loading state\n */\nfunction setButtonLoading(loading: boolean): void {\n  if (loading) {\n    elements.saveBtn.classList.add('loading');\n    elements.saveBtn.disabled = true;\n  } else {\n    elements.saveBtn.classList.remove('loading');\n    elements.saveBtn.disabled = false;\n  }\n}\n\n/**\n * Set retranslate button loading state\n */\nfunction setRetranslateButtonLoading(loading: boolean): void {\n  if (loading) {\n    elements.retranslateBtn.classList.add('loading');\n    elements.retranslateBtn.disabled = true;\n  } else {\n    elements.retranslateBtn.classList.remove('loading');\n    elements.retranslateBtn.disabled = false;\n  }\n}\n\n/**\n * Update form disabled state based on main toggle\n */\nfunction updateFormState(enabled: boolean): void {\n  if (enabled) {\n    elements.settingsForm.classList.remove('disabled');\n  } else {\n    elements.settingsForm.classList.add('disabled');\n  }\n}\n\n/**\n * Populate form with settings\n */\nfunction populateForm(settings: UserSettings): void {\n  elements.enabled.checked = settings.enabled;\n  elements.provider.value = settings.provider;\n  updateModelOptions(settings.provider);\n  elements.model.value = settings.model;\n  elements.apiKey.value = settings.apiKey;\n  elements.autoTranslate.checked = settings.autoTranslate;\n  elements.preloadEnabled.checked = settings.preloadEnabled;\n  elements.showCostEstimate.checked = settings.showCostEstimate;\n  elements.showLoadingIndicator.checked = settings.showLoadingIndicator;\n  updateFormState(settings.enabled);\n  setCostDisplayVisible(settings.showCostEstimate);\n}\n\n/**\n * Get current form values\n */\nfunction getFormValues(): UserSettings {\n  return {\n    enabled: elements.enabled.checked,\n    provider: elements.provider.value as 'openai' | 'gemini',\n    apiKey: elements.apiKey.value,\n    model: elements.model.value,\n    autoTranslate: elements.autoTranslate.checked,\n    preloadEnabled: elements.preloadEnabled.checked,\n    showCostEstimate: elements.showCostEstimate.checked,\n    showLoadingIndicator: elements.showLoadingIndicator.checked,\n  };\n}\n\n// ============================================\n// Event Handlers\n// ============================================\n\n/**\n * Handle provider change\n */\nfunction handleProviderChange(): void {\n  const provider = elements.provider.value;\n  updateModelOptions(provider);\n  hideValidationResult();\n}\n\n/**\n * Handle API key visibility toggle\n */\nfunction handleApiKeyVisibilityToggle(): void {\n  const isPassword = elements.apiKey.type === 'password';\n  elements.apiKey.type = isPassword ? 'text' : 'password';\n\n  // Update eye icon\n  const eyePath = document.getElementById('eye-path');\n  if (eyePath) {\n    if (isPassword) {\n      // Show \"eye-off\" icon path\n      eyePath.setAttribute(\n        'd',\n        'M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7zM2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3 2 4.27zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2zm4.31-.78l3.15 3.15.02-.16c0-1.66-1.34-3-3-3l-.17.01z'\n      );\n    } else {\n      // Show \"eye\" icon path\n      eyePath.setAttribute(\n        'd',\n        'M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z'\n      );\n    }\n  }\n}\n\n/**\n * Handle main toggle change\n */\nasync function handleEnabledChange(): Promise<void> {\n  const enabled = elements.enabled.checked;\n  updateFormState(enabled);\n\n  try {\n    await saveSettings({ enabled });\n    const settings = getFormValues();\n    await notifySettingsChanged(settings);\n  } catch (error) {\n    showStatus('\u4FDD\u5B58\u5931\u8D25', 'error');\n  }\n}\n\n/**\n * Handle additional setting change\n */\nasync function handleAdditionalSettingChange(key: keyof UserSettings): Promise<void> {\n  const checkbox = elements[key as keyof DOMElements] as HTMLInputElement;\n  if (!checkbox) return;\n\n  try {\n    await saveSettings({ [key]: checkbox.checked });\n    const settings = getFormValues();\n    await notifySettingsChanged(settings);\n\n    if (key === 'showCostEstimate') {\n      setCostDisplayVisible(checkbox.checked);\n      if (checkbox.checked) {\n        sessionCostState = await loadSessionCost();\n        renderCostDisplay();\n      }\n    }\n  } catch (error) {\n    showStatus('\u4FDD\u5B58\u5931\u8D25', 'error');\n  }\n}\n\n/**\n * Handle form submission (save & validate)\n */\nasync function handleFormSubmit(event: Event): Promise<void> {\n  event.preventDefault();\n  hideValidationResult();\n  setButtonLoading(true);\n\n  const settings = getFormValues();\n\n  try {\n    // Validate API key\n    const validation = await validateApiKey(settings.provider, settings.apiKey);\n\n    if (validation.valid) {\n      // Save settings\n      await saveSettings(settings);\n      await notifySettingsChanged(settings);\n      showValidationResult(true, 'API Key \u9A8C\u8BC1\u6210\u529F\uFF0C\u8BBE\u7F6E\u5DF2\u4FDD\u5B58');\n    } else {\n      showValidationResult(false, validation.error || '\u9A8C\u8BC1\u5931\u8D25');\n    }\n  } catch (error) {\n    showValidationResult(\n      false,\n      error instanceof Error ? error.message : '\u4FDD\u5B58\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5'\n    );\n  } finally {\n    setButtonLoading(false);\n  }\n}\n\n// ============================================\n// Retranslate Handlers\n// ============================================\n\nfunction generateTaskId(): string {\n  return `retranslate-${Date.now()}-${Math.random().toString(16).slice(2)}`;\n}\n\nasync function getActiveUdemyTabId(): Promise<number | null> {\n  if (typeof chrome === 'undefined' || !chrome.tabs?.query) return null;\n\n  const tabs = await chrome.tabs.query({ active: true, currentWindow: true });\n  const tab = tabs[0];\n  if (!tab?.id) return null;\n\n  // Best-effort URL check: only allow udemy pages\n  if (tab.url && !/\\/\\/([^/]*\\.)?udemy\\.com\\//i.test(tab.url)) {\n    return null;\n  }\n\n  return tab.id;\n}\n\nasync function handleRetranslateClick(): Promise<void> {\n  const tabId = await getActiveUdemyTabId();\n  if (!tabId) {\n    showStatus('\u8BF7\u5148\u6253\u5F00 Udemy \u8BFE\u7A0B\u64AD\u653E\u9875', 'error');\n    return;\n  }\n\n  const taskId = generateTaskId();\n  currentRetranslateTaskId = taskId;\n  setRetranslateButtonLoading(true);\n  showStatus('\u5DF2\u53D1\u8D77\u91CD\u8BD1\u8BF7\u6C42\u2026', 'info', false);\n\n  try {\n    await chrome.tabs.sendMessage(tabId, {\n      type: 'RETRANSLATE_CURRENT',\n      payload: { taskId },\n    });\n  } catch (error) {\n    currentRetranslateTaskId = null;\n    setRetranslateButtonLoading(false);\n    showStatus('\u53D1\u9001\u5931\u8D25\uFF1A\u8BF7\u5237\u65B0\u8BFE\u7A0B\u9875\u540E\u91CD\u8BD5', 'error');\n  }\n}\n\nfunction setupRetranslateMessageListener(): void {\n  if (typeof chrome === 'undefined' || !chrome.runtime?.onMessage) return;\n\n  chrome.runtime.onMessage.addListener((message: any) => {\n    if (!message || typeof message !== 'object') return;\n\n    if (message.type === 'COST_ESTIMATE') {\n      const payload = message.payload;\n      if (!payload || typeof payload !== 'object') return;\n\n      const taskId = typeof payload.taskId === 'string' ? payload.taskId : '';\n      const provider = payload.provider === 'gemini' ? 'gemini' : 'openai';\n      const model = typeof payload.model === 'string' ? payload.model : '';\n      const cueCount = typeof payload.cueCount === 'number' ? payload.cueCount : 0;\n      const estimatedTotalTokens =\n        typeof payload.estimatedTotalTokens === 'number' ? payload.estimatedTotalTokens : 0;\n      const estimatedCostUsd =\n        typeof payload.estimatedCostUsd === 'number' ? payload.estimatedCostUsd : 0;\n\n      if (!taskId || !model) return;\n\n      sessionCostState = {\n        ...sessionCostState,\n        lastEstimate: {\n          taskId,\n          provider,\n          model,\n          cueCount,\n          estimatedTotalTokens,\n          estimatedCostUsd,\n          createdAt: Date.now(),\n        },\n      };\n\n      if (elements.showCostEstimate.checked) {\n        renderCostDisplay();\n      }\n      return;\n    }\n\n    if (message.type === 'CACHE_HIT') {\n      const payload = message.payload;\n      if (!payload || typeof payload !== 'object') return;\n\n      const taskId = typeof payload.taskId === 'string' ? payload.taskId : '';\n      const provider = payload.provider === 'gemini' ? 'gemini' : 'openai';\n      const model = typeof payload.model === 'string' ? payload.model : '';\n      const tokensUsed = typeof payload.tokensUsed === 'number' ? payload.tokensUsed : 0;\n      const costUsd = typeof payload.costUsd === 'number' ? payload.costUsd : 0;\n\n      if (taskId && model && (tokensUsed > 0 || costUsd > 0)) {\n        sessionCostState = {\n          ...sessionCostState,\n          lastActual: {\n            taskId,\n            provider,\n            model,\n            tokensUsed,\n            costUsd,\n            createdAt: Date.now(),\n          },\n        };\n        if (elements.showCostEstimate.checked) {\n          renderCostDisplay();\n        }\n      }\n      return;\n    }\n\n    if (message.type === 'TRANSLATION_PROGRESS') {\n      const taskId = message.payload?.taskId;\n      const progress = message.payload?.progress;\n      if (!currentRetranslateTaskId || taskId !== currentRetranslateTaskId) return;\n      if (typeof progress !== 'number') return;\n\n      const clamped = Math.max(0, Math.min(100, Math.round(progress)));\n      showStatus(`\u91CD\u8BD1\u4E2D\u2026 ${clamped}%`, 'info', false);\n      return;\n    }\n\n    if (message.type === 'TRANSLATION_COMPLETE') {\n      const payload = message.payload;\n      const taskId = payload?.taskId;\n\n      // Update cost display (best-effort, not limited to popup-initiated tasks)\n      if (payload && typeof payload === 'object') {\n        const tokensUsed = typeof payload.tokensUsed === 'number' ? payload.tokensUsed : 0;\n        const costUsd = typeof payload.estimatedCost === 'number' ? payload.estimatedCost : 0;\n        const sessionTotalTokens =\n          typeof payload.sessionTotalTokens === 'number' ? payload.sessionTotalTokens : null;\n        const sessionTotalCostUsd =\n          typeof payload.sessionTotalCostUsd === 'number' ? payload.sessionTotalCostUsd : null;\n\n        if (typeof taskId === 'string') {\n          const estimateMatch = sessionCostState.lastEstimate?.taskId === taskId\n            ? sessionCostState.lastEstimate\n            : null;\n          const fallbackProvider = estimateMatch ? estimateMatch.provider : 'openai';\n          const fallbackModel = estimateMatch ? estimateMatch.model : elements.model.value;\n\n          const provider =\n            payload.provider === 'gemini' ? 'gemini' : payload.provider === 'openai' ? 'openai' : fallbackProvider;\n          const model = typeof payload.model === 'string' ? payload.model : fallbackModel;\n\n          if (model && (tokensUsed > 0 || costUsd > 0)) {\n            sessionCostState = {\n              ...sessionCostState,\n              lastActual: {\n                taskId,\n                provider,\n                model,\n                tokensUsed,\n                costUsd,\n                createdAt: Date.now(),\n              },\n            };\n          }\n        }\n\n        if (sessionTotalTokens !== null && sessionTotalCostUsd !== null) {\n          sessionCostState = {\n            ...sessionCostState,\n            totals: {\n              totalTokens: sessionTotalTokens,\n              totalCostUsd: sessionTotalCostUsd,\n              updatedAt: Date.now(),\n            },\n          };\n        }\n\n        if (elements.showCostEstimate.checked) {\n          renderCostDisplay();\n        }\n      }\n\n      // Only react when we have an active task; if taskId is missing, treat it as best-effort.\n      if (!currentRetranslateTaskId) return;\n      if (taskId && taskId !== currentRetranslateTaskId) return;\n\n      const success = payload?.success === true;\n      const errorText = payload?.error;\n\n      currentRetranslateTaskId = null;\n      setRetranslateButtonLoading(false);\n      showStatus(success ? '\u91CD\u8BD1\u5B8C\u6210' : `\u91CD\u8BD1\u5931\u8D25\uFF1A${errorText || '\u672A\u77E5\u9519\u8BEF'}`, success ? 'success' : 'error');\n    }\n  });\n}\n\n// ============================================\n// Initialization\n// ============================================\n\n/**\n * Initialize popup\n */\nasync function init(): Promise<void> {\n  elements = getDOMElements();\n\n  // Load and populate settings\n  const settings = await loadSettings();\n  populateForm(settings);\n\n  if (settings.showCostEstimate) {\n    sessionCostState = await loadSessionCost();\n    renderCostDisplay();\n  }\n\n  // Event listeners\n  elements.provider.addEventListener('change', handleProviderChange);\n  elements.toggleApiKeyVisibility.addEventListener('click', handleApiKeyVisibilityToggle);\n  elements.enabled.addEventListener('change', handleEnabledChange);\n  elements.settingsForm.addEventListener('submit', handleFormSubmit);\n\n  // Additional settings listeners\n  elements.autoTranslate.addEventListener('change', () =>\n    handleAdditionalSettingChange('autoTranslate')\n  );\n  elements.preloadEnabled.addEventListener('change', () =>\n    handleAdditionalSettingChange('preloadEnabled')\n  );\n  elements.showCostEstimate.addEventListener('change', () =>\n    handleAdditionalSettingChange('showCostEstimate')\n  );\n  elements.showLoadingIndicator.addEventListener('change', () =>\n    handleAdditionalSettingChange('showLoadingIndicator')\n  );\n\n  // Manual retranslate button\n  elements.retranslateBtn.addEventListener('click', handleRetranslateClick);\n  setupRetranslateMessageListener();\n\n  // Hide validation result when API key changes\n  elements.apiKey.addEventListener('input', hideValidationResult);\n}\n\n// Start initialization when DOM is ready\ndocument.addEventListener('DOMContentLoaded', init);\n\n// Export for testing\nexport {\n  loadSettings,\n  saveSettings,\n  validateApiKey,\n  validateOpenAIKey,\n  validateGeminiKey,\n  PROVIDER_MODELS,\n  DEFAULT_SETTINGS,\n};\n"],
  "mappings": "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",
  "names": []
}
